---
import OfferCard from "@/components/OfferCard";
import { ChevronDown } from "lucide-react";
import type { ScraperResult } from "@nerd-ofertas/types";

interface Props {
  offers: ScraperResult[];
}

const { offers } = Astro.props;

// Sort by price ascending
const sortedOffers = [...offers].sort((a, b) => a.price - b.price);
const bestPrice = sortedOffers[0]?.price;
---

<div class="space-y-4">
  {/* Comparison Header - Buscapé Style */}
  <div class="flex items-center justify-between p-4 bg-muted/30 border border-border rounded-xl">
    <div class="flex items-center gap-3">
      <h3 class="text-lg font-bold text-foreground">
        Compare preços em {offers.length} {offers.length === 1 ? 'loja' : 'lojas'}
      </h3>
      <div class="hidden md:block text-xs text-muted-foreground">
        Ordenado por menor preço
      </div>
    </div>
    
    {/* Future: Add sorting dropdown */}
    <button 
      class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors rounded-lg hover:bg-muted/50"
      aria-label="Opções de ordenação"
      disabled
    >
      <span class="hidden sm:inline">Ordenar</span>
      <ChevronDown class="w-4 h-4" />
    </button>
  </div>

  {/* Offers Grid */}
  <div class="space-y-3">
    {sortedOffers.map((offer, index) => {
      const isBestPrice = offer.price === bestPrice;
      const rank = index + 1;
      
      return (
        <OfferCard
          offer={offer}
          isBestPrice={isBestPrice}
          rank={rank}
        />
      );
    })}
  </div>

  {/* Empty State */}
  {offers.length === 0 && (
    <div class="text-center py-12 bg-muted/20 rounded-xl border border-border border-dashed">
      <p class="text-muted-foreground">Nenhuma oferta disponível no momento.</p>
      <p class="text-sm text-muted-foreground/70 mt-1">Volte em breve para conferir novos preços.</p>
    </div>
  )}
</div>
